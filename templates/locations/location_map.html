<!DOCTYPE html>
<html lang="en">
<head>
  {% load static %}
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tawi | Manage Planting Sites</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <style>
    body {
      background-image: url('{% static "img/tawi_forest_bg.jpg" %}');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
    }
    .glass {
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(34,197,94,0.2);
      border-radius: 16px;
      box-shadow: 0 6px 20px rgba(34,197,94,0.15);
    }
    .btn-green { background-color: #22c55e; color: white; font-weight: 600; border-radius: 8px; padding: 0.4rem 1rem; transition: 0.2s; }
    .btn-green:hover { background-color: #16a34a; }
    .btn-red { background-color: #dc2626; color: white; border-radius: 8px; padding: 0.4rem 1rem; }
    .btn-yellow { background-color: #facc15; color: #3f3f46; border-radius: 8px; padding: 0.4rem 1rem; }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center p-8 bg-green-50/60">

  <!-- Header -->
  <header class="text-center mb-10">
    <div class="flex flex-col items-center gap-3">
  <img src="{% static 'img/tawi_logo.png' %}" alt="Tawi Logo" class="w-16 h-16 rounded-full border border-green-300" onerror="this.onerror=null;this.src='{% static 'img/tawi_leaf_logo.svg' %}';" />
      <h1 class="text-3xl font-extrabold text-green-700">Manage Tree Planting Sites ðŸŒ³</h1>
      <p class="text-green-600 text-sm">Admins can view, edit, add, or delete site details.</p>
    </div>
  </header>

  <!-- Add New Site (admin only) -->
  {% if request.user.is_authenticated and request.user.has_perm "beneficiaries.manage_sites" %}
  <div class="glass w-full max-w-4xl p-6 mb-10">
    <h2 class="text-green-700 font-semibold text-lg mb-4 flex items-center gap-2">
      <i data-feather="plus-circle" class="w-5 h-5 text-green-600"></i> Add New Site
    </h2>
    <div>
      <a href="{% url 'locations:add_site' %}" class="btn-green">Add Site</a>
    </div>
  </div>
  {% endif %}

  <!-- Manage Planted and Needed Sites -->
  <section class="glass w-full max-w-6xl p-6 mb-8">
    <h2 class="text-green-700 font-semibold text-lg mb-4 flex items-center gap-2">
      <i data-feather="edit" class="w-5 h-5 text-green-600"></i> Manage Existing Sites
    </h2>
    <table class="w-full text-sm text-left">
      <thead class="bg-green-100 text-green-700 uppercase text-xs">
        <tr>
          <th class="px-4 py-2">#</th>
          <th class="px-4 py-2">Location</th>
          <th class="px-4 py-2">Trees</th>
          <th class="px-4 py-2">Status</th>
          <th class="px-4 py-2 text-right">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for site in all_sites %}
        <tr class="border-t border-green-100 hover:bg-green-50 transition">
          <td class="px-4 py-2">{{ forloop.counter }}</td>
          <td class="px-4 py-2 font-medium text-green-700">{{ site.location }}</td>
          <td class="px-4 py-2">{{ site.trees_needed }}</td>
          <td class="px-4 py-2">{{ site.status }}</td>
          <td class="px-4 py-2 text-right space-x-2">
            {% if request.user.is_authenticated and request.user.has_perm "beneficiaries.manage_sites" %}
              <a href="{% url 'locations:edit_site' site.id %}" class="btn-yellow text-xs">Edit</a>
              <form method="post" action="{% url 'locations:delete_site' site.id %}" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn-red text-xs" onclick="return confirm('Are you sure you want to delete this site?')">Delete</button>
              </form>
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="5" class="text-center py-4 text-green-600">No sites available ðŸŒ±</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

  <!-- Footer -->
  <footer class="mt-8 text-center text-green-400 text-xs">
    Â© 2025 Tawi Tree Planting Project | Admin Panel
  </footer>

  <script>feather.replace();</script>
</body>
</html>
